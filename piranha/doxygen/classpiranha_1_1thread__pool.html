<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>piranha: piranha::thread_pool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">piranha
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacepiranha.html">piranha</a></li><li class="navelem"><a class="el" href="classpiranha_1_1thread__pool.html">thread_pool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classpiranha_1_1thread__pool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">piranha::thread_pool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Static thread pool.  
 <a href="classpiranha_1_1thread__pool.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>&gt;</code></p>

<p>Inherits piranha::detail::thread_pool_base&lt;&gt;.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a3478c7cb97f5030d943d5d99e50717a3"><td class="memTemplParams" colspan="2">template&lt;typename F , typename... Args&gt; </td></tr>
<tr class="memitem:a3478c7cb97f5030d943d5d99e50717a3"><td class="memTemplItemLeft" align="right" valign="top">static auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classpiranha_1_1thread__pool.html#a3478c7cb97f5030d943d5d99e50717a3">enqueue</a> (unsigned n, F &amp;&amp;f, Args &amp;&amp;...args) -&gt; decltype(base::s_queues[0u]-&gt;enqueue(std::forward&lt; F &gt;(f), std::forward&lt; Args &gt;(args)...))</td></tr>
<tr class="memdesc:a3478c7cb97f5030d943d5d99e50717a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append task.  <a href="#a3478c7cb97f5030d943d5d99e50717a3">More...</a><br /></td></tr>
<tr class="separator:a3478c7cb97f5030d943d5d99e50717a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28ee9a80c039c6f37a69cf3d9c77fc51"><td class="memItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpiranha_1_1thread__pool.html#a28ee9a80c039c6f37a69cf3d9c77fc51">size</a> ()</td></tr>
<tr class="memdesc:a28ee9a80c039c6f37a69cf3d9c77fc51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Size.  <a href="#a28ee9a80c039c6f37a69cf3d9c77fc51">More...</a><br /></td></tr>
<tr class="separator:a28ee9a80c039c6f37a69cf3d9c77fc51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fe0d62525f87aa4267f41df5601167c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpiranha_1_1thread__pool.html#a6fe0d62525f87aa4267f41df5601167c">resize</a> (unsigned new_size)</td></tr>
<tr class="memdesc:a6fe0d62525f87aa4267f41df5601167c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pool resize.  <a href="#a6fe0d62525f87aa4267f41df5601167c">More...</a><br /></td></tr>
<tr class="separator:a6fe0d62525f87aa4267f41df5601167c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac147eecbc994f3968b77a58178dc4b26"><td class="memTemplParams" colspan="2">template&lt;typename Int , typename  = typename std::enable_if&lt;(std::is_integral&lt;Int&gt;::value &amp;&amp; std::is_unsigned&lt;Int&gt;::value) ||			std::is_same&lt;Int,integer&gt;::value&gt;::type&gt; </td></tr>
<tr class="memitem:ac147eecbc994f3968b77a58178dc4b26"><td class="memTemplItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classpiranha_1_1thread__pool.html#ac147eecbc994f3968b77a58178dc4b26">use_threads</a> (const Int &amp;work_size, const Int &amp;min_work_per_thread)</td></tr>
<tr class="memdesc:ac147eecbc994f3968b77a58178dc4b26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute number of threads to use.  <a href="#ac147eecbc994f3968b77a58178dc4b26">More...</a><br /></td></tr>
<tr class="separator:ac147eecbc994f3968b77a58178dc4b26"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Static thread pool. </p>
<p>This class manages, via a set of static methods, a pool of threads created at program startup. The number of threads created initially is equal to <a class="el" href="classpiranha_1_1runtime__info.html#ac3fd942fc4483b8b12a1214e13acea9b" title="Hardware concurrency. ">piranha::runtime_info::get_hardware_concurrency()</a>, and, if possible, each thread is bound to a different processor. If the hardware concurrency cannot be determined, the size of the thread pool will be one.</p>
<p>This class provides methods to enqueue arbitray tasks to the threads in the pool, query the size of the pool and resize the pool. All methods, unless otherwise specified, are thread-safe, and they provide the strong exception safety guarantee.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd><p class="startdd">work around MSVC bug in destruction of statically allocated threads (if needed once we support MSVC), as per: <a href="http://stackoverflow.com/questions/10915233/stdthreadjoin-hangs-if-called-after-main-exits-when-using-vs2012-rc">http://stackoverflow.com/questions/10915233/stdthreadjoin-hangs-if-called-after-main-exits-when-using-vs2012-rc</a> detach() and wait as a workaround? </p>
<p class="enddd">try to understand if we can suppress the future list class below in favour of STL-like algorithms. </p>
</dd></dl>

<p>Definition at line <a class="el" href="thread__pool_8hpp_source.html#l00206">206</a> of file <a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a3478c7cb97f5030d943d5d99e50717a3"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F , typename... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static auto piranha::thread_pool::enqueue </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> -&gt; decltype(base::s_queues[0u]-&gt;enqueue(std::forward&lt;F&gt;(f),std::forward&lt;Args&gt;(args)...))
		</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Append task. </p>
<dl class="section note"><dt>Note</dt><dd>This method is enabled only if the expression <code>f(args...)</code> is well-formed.</dd></dl>
<p>This method will add a task to the <code>n</code>-th thread in the pool. The task is represented by a callable <code>F</code> and its arguments <code>args</code>, which will be copied into an execution queue consumed by the thread to which the task is assigned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>index of the thread that will consume the task. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f</td><td>callable object representing the task. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">args</td><td>arguments to <code>f</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an <code>std::future</code> that will store the result of <code>f(args...)</code>.</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::invalid_argument</td><td>if the thread index is equal to or larger than the current pool size. </td></tr>
    <tr><td class="paramname">unspecified</td><td>any exception thrown by:<ul>
<li>threading primitives,</li>
<li>memory allocation errors,</li>
<li>the constructors of <code>f</code> or <code>args</code>. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="thread__pool_8hpp_source.html#l00232">232</a> of file <a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6fe0d62525f87aa4267f41df5601167c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void piranha::thread_pool::resize </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>new_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pool resize. </p>
<p>This method will resize the internal pool to contain <code>new_size</code> threads. The method will first wait for the threads to consume all the pending tasks (while forbidding the addition of new tasks), and it will then create a new pool of size <code>new_size</code>. The new threads will be bound, if possible, to the processor corresponding to their index in the pool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_size</td><td>the new size of the pool.</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::invalid_argument</td><td>if <code>new_size</code> is larger than an implementation-defined value or zero. </td></tr>
    <tr><td class="paramname">unspecified</td><td>any exception thrown by:<ul>
<li>threading primitives,</li>
<li>memory allocation errors. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="thread__pool_8hpp_source.html#l00268">268</a> of file <a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a28ee9a80c039c6f37a69cf3d9c77fc51"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned piranha::thread_pool::size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Size. </p>
<dl class="section return"><dt>Returns</dt><dd>the number of threads in the pool.</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">unspecified</td><td>any exception thrown by threading primitives. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="thread__pool_8hpp_source.html#l00248">248</a> of file <a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac147eecbc994f3968b77a58178dc4b26"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Int , typename  = typename std::enable_if&lt;(std::is_integral&lt;Int&gt;::value &amp;&amp; std::is_unsigned&lt;Int&gt;::value) ||			std::is_same&lt;Int,integer&gt;::value&gt;::type&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned piranha::thread_pool::use_threads </td>
          <td>(</td>
          <td class="paramtype">const Int &amp;&#160;</td>
          <td class="paramname"><em>work_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Int &amp;&#160;</td>
          <td class="paramname"><em>min_work_per_thread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute number of threads to use. </p>
<dl class="section note"><dt>Note</dt><dd>This function is enabled only if <code>Int</code> is an unsigned integer type or <a class="el" href="namespacepiranha.html#a236e3b8e7d5b78d00fcdc5de941e9f4b" title="Alias for piranha::mp_integer with default bit size. ">piranha::integer</a>.</dd></dl>
<p>This function computes the suggested number of threads to use, given an amount of total <code>work_size</code> units of work and a minimum amount of work units per thread <code>min_work_per_thread</code>.</p>
<p>The returned value will always be 1 if the calling thread is not the main thread; otherwise, a number of threads such that each thread has at least <code>min_work_per_thread</code> units of work to consume will be returned. In any case, the return value is always greater than zero.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">work_size</td><td>total number of work units. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_work_per_thread</td><td>minimum number of work units to be consumed by a thread in the pool.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the suggested number of threads to be used, always greater than zero.</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::invalid_argument</td><td>if <code>min_work_per_thread</code> is zero. </td></tr>
    <tr><td class="paramname">unspecified</td><td>any exception thrown by threading primitives. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="thread__pool_8hpp_source.html#l00312">312</a> of file <a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="thread__pool_8hpp_source.html">thread_pool.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 18 2015 21:06:04 for piranha by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9
</small></address>
</body>
</html>
